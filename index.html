<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è - –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 0;
            min-height: 100vh;
        }
        
        /* –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .top-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .top-bar h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .top-bar-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* –¢–ê–ô–ú–ï–†–´ */
        .timer-panel {
            background: white;
            padding: 15px 20px;
            display: flex;
            gap: 30px;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 101;
        }
        
        .timer-item {
            flex: 1;
        }
        
        .timer-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .timer-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        /* –ü–ê–ù–ï–õ–¨ –í–´–°–¢–£–ü–ê–Æ–©–ï–ì–û */
        .speaker-panel {
            background: #fff3cd;
            padding: 15px 20px;
            border-bottom: 3px solid #ffc107;
            position: sticky;
            top: 78px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .speaker-current {
            font-size: 18px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .speaker-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
        }
        
        .speaker-btn {
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .speaker-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }
        
        .speaker-btn.active {
            background: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.3);
        }
        
        .speaker-btn-name {
            font-size: 13px;
        }
        
        .speaker-btn-time {
            font-size: 11px;
            opacity: 0.9;
            font-weight: normal;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 10px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        /* –í–´–ë–û–† –£–ß–ê–°–¢–ù–ò–ö–û–í */
        .participants-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .participant-checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .participant-checkbox-item:hover {
            background: #f0f0f0;
        }
        
        .participant-checkbox-item.selected {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .participant-checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .participant-info-mini {
            flex: 1;
        }
        
        .participant-name-mini {
            font-weight: 600;
            font-size: 14px;
        }
        
        .participant-role-mini {
            font-size: 11px;
            color: #666;
        }
        
        /* –°–¢–ê–¢–£–°–´ –£–ß–ê–°–¢–ù–ò–ö–û–í */
        .attendance-compact {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .attendance-item {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #ddd;
        }
        
        .attendance-item.present {
            background: #d4edda;
            border-left-color: #28a745;
        }
        
        .attendance-item.late {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .attendance-item.absent {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .attendance-item-name {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .attendance-btns {
            display: flex;
            gap: 5px;
        }
        
        .status-btn-mini {
            flex: 1;
            padding: 6px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .status-btn-mini:hover {
            transform: scale(1.05);
        }
        
        .btn-present {
            background: #28a745;
            color: white;
        }
        
        .btn-late {
            background: #ffc107;
            color: #000;
        }
        
        .btn-absent {
            background: #dc3545;
            color: white;
        }
        
        /* –ü–û–õ–Ø –í–í–û–î–ê */
        input[type="text"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* –°–¢–†–û–ö–ò –î–ê–ù–ù–´–• */
        .data-row {
            display: grid;
            gap: 10px;
            margin-bottom: 10px;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 6px;
            align-items: center;
        }
        
        .vehicle-row {
            grid-template-columns: 2fr 100px 100px 60px;
        }
        
        .task-row {
            grid-template-columns: 40px 2fr 1.5fr 120px 80px 60px;
        }
        
        .task-row.closed {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        .bottleneck-row {
            grid-template-columns: 2fr 1.5fr 2fr 1.5fr 80px 60px;
        }
        
        .bottleneck-row.closed {
            opacity: 0.5;
        }
        
        .growth-row {
            grid-template-columns: 2fr 2fr 1.5fr 80px 60px;
        }
        
        .growth-row.closed {
            opacity: 0.5;
        }
        
        .data-row input,
        .data-row select {
            padding: 8px;
            font-size: 13px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .btn-add {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .btn-add:hover {
            background: #5568d3;
        }
        
        /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow: auto;
            padding: 20px;
        }
        
        .modal-content {
            max-width: 1000px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #667eea;
        }
        
        .close-modal {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            z-index: 1001;
        }
        
        /* –¢–ê–ë–õ–ò–¶–´ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }
        
        table th,
        table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        /* –§–û–†–ú–´ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 13px;
            color: #555;
        }
        
        /* –ò–°–¢–û–†–ò–Ø */
        .history-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .history-item h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .history-item p {
            color: #666;
            font-size: 13px;
            margin: 4px 0;
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            .timer-panel {
                flex-direction: column;
                gap: 15px;
            }
            
            .speaker-controls {
                grid-template-columns: 1fr 1fr;
            }
            
            .attendance-compact {
                grid-template-columns: 1fr;
            }
            
            .participants-selector {
                grid-template-columns: 1fr;
            }
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .modal-content,
            .modal-content * {
                visibility: visible;
            }
            .modal-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .close-modal {
                display: none;
            }
        }
        
        .search-box {
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .quick-fill-btns {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .quick-fill-btn {
            padding: 8px 16px;
            background: #e0e0e0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        
        .quick-fill-btn:hover {
            background: #d0d0d0;
        }
        
        .checklist-item {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .checklist-item:hover {
            background: #f0f0f0;
        }
        
        .checklist-item.completed {
            background: #d4edda;
            opacity: 0.7;
        }
        
        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .checklist-item-text {
            flex: 1;
            font-size: 13px;
            line-height: 1.3;
        }
        
        .checklist-item.completed .checklist-item-text {
            text-decoration: line-through;
            color: #666;
        }
        
        .checklist-item .btn-small {
            flex-shrink: 0;
        }
        
        .timer-warning {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .timer-value.warning-30 {
            color: #ffc107;
        }
        
        .timer-value.warning-40 {
            color: #ff9800;
        }
        
        .timer-value.warning-60 {
            color: #dc3545;
        }
        
        .focus-item, .goal-item {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #ddd;
        }
        
        .focus-item {
            background: #ffe5e5;
            border-left-color: #dc3545;
        }
        
        .goal-item {
            background: #e5f5e5;
            border-left-color: #28a745;
        }
        
        .focus-item.closed, .goal-item.closed {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        .focus-goal-text {
            flex: 1;
            margin-right: 10px;
        }
        
        .focus-goal-text strong {
            display: block;
            margin-bottom: 4px;
        }
        
        .focus-goal-text small {
            color: #666;
            font-size: 11px;
        }
        
        .focus-goal-buttons {
            display: flex;
            gap: 5px;
        }
        
        /* –ü–õ–ê–í–ê–Æ–©–ò–ô –ß–ï–ö–õ–ò–°–¢ */
        .checklist-float {
            position: fixed;
            top: 140px;
            right: 20px;
            width: 350px;
            max-height: calc(100vh - 160px);
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 200;
            display: none;
            overflow: hidden;
        }
        
        .checklist-float.show {
            display: block;
        }
        
        .checklist-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .checklist-header h3 {
            margin: 0;
            font-size: 16px;
        }
        
        .checklist-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        
        .checklist-body {
            padding: 15px;
            max-height: calc(100vh - 240px);
            overflow-y: auto;
        }
        
        .checklist-footer {
            padding: 10px 15px;
            border-top: 1px solid #e0e0e0;
            background: #f9f9f9;
        }
        
        @media (max-width: 768px) {
            .checklist-float {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
    <div class="top-bar">
        <h1>üìä –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–æ–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞</h1>
        <div class="top-bar-actions">
            <button class="btn btn-success" onclick="saveProtocol()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª</button>
            <button class="btn btn-primary" onclick="showHistory()">üìö –ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="btn btn-secondary" onclick="newMeeting()">üÜï –ù–æ–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞</button>
        </div>
    </div>
    
    <!-- –¢–ê–ô–ú–ï–†–´ -->
    <div class="timer-panel">
        <div style="flex: 1; font-size: 12px; color: #666;" id="timerMessage">
            –ò–¥–µ–∞–ª—å–Ω–æ: –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞ 40-50 –º–∏–Ω—É—Ç
        </div>
        <div class="timer-item">
            <div class="timer-label">–í—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏ (40-60 –º–∏–Ω)</div>
            <div class="timer-value" id="totalTimer">00:00</div>
        </div>
        <div class="timer-item">
            <div class="timer-label">–í—ã—Å—Ç—É–ø–∞–µ—Ç —Å–µ–π—á–∞—Å</div>
            <div class="timer-value" id="speakerTimer">00:00</div>
        </div>
        <button class="btn btn-primary" onclick="toggleChecklist()" style="min-width: 120px;">‚úÖ –ß–µ–∫–ª–∏—Å—Ç</button>
    </div>
    
    <!-- –ü–ê–ù–ï–õ–¨ –í–´–°–¢–£–ü–ê–Æ–©–ï–ì–û -->
    <div class="speaker-panel">
        <div class="speaker-current" id="currentSpeaker">–ù–∏–∫—Ç–æ –Ω–µ –≤—ã—Å—Ç—É–ø–∞–µ—Ç</div>
        <div class="speaker-controls" id="speakerControls">
            <button class="btn btn-danger" onclick="stopSpeaker()">‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <div class="container">
        <!-- –í–´–ë–û–† –£–ß–ê–°–¢–ù–ò–ö–û–í -->
        <div class="card">
            <div class="card-title">
                ‚úÖ –®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–∏
                <span class="badge badge-info" id="selectedCount">0 –≤—ã–±—Ä–∞–Ω–æ</span>
            </div>
            
            <div class="quick-fill-btns">
                <button class="quick-fill-btn" onclick="selectAll()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö</button>
                <button class="quick-fill-btn" onclick="deselectAll()">–°–Ω—è—Ç—å –≤—Å–µ—Ö</button>
                <button class="quick-fill-btn" onclick="selectLastMeeting()">–ö–∞–∫ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchParticipants" placeholder="üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..." onkeyup="filterParticipants()">
            </div>
            
            <div class="participants-selector" id="participantsSelector"></div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
        <div class="card">
            <div class="card-title">üìã –®–∞–≥ 2: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">–î–∞—Ç–∞:</label>
                    <input type="date" id="meetingDate">
                </div>
                <div class="form-group">
                    <label class="form-label">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                    <input type="time" id="startTime">
                </div>
                <div class="form-group">
                    <label class="form-label">–í–µ–¥—É—â–∏–π:</label>
                    <select id="facilitator"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü—Ä–æ—Ç–æ–∫–æ–ª–∏—Å—Ç:</label>
                    <select id="secretary"></select>
                </div>
            </div>
        </div>
        
        <!-- –§–û–ö–£–°–´ –ò –¶–ï–õ–ò -->
        <div class="card">
            <div class="card-title">
                üéØ –®–∞–≥ 3: –§–æ–∫—É—Å—ã –∏ —Ü–µ–ª–∏ (–ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –∑–∞–∫—Ä–æ–µ—à—å)
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #dc3545; margin-bottom: 10px; font-size: 16px;">üî¥ –§–û–ö–£–°–´</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">–ù–∞ —á—ë–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</p>
                <div id="focusesContainer"></div>
                <button class="btn-add" onclick="addFocus()">+ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ–∫—É—Å</button>
            </div>
            
            <div>
                <h4 style="color: #28a745; margin-bottom: 10px; font-size: 16px;">üü¢ –¶–ï–õ–ò</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">–ö—É–¥–∞ –¥–≤–∏–∂–µ–º—Å—è –≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ</p>
                <div id="goalsContainer"></div>
                <button class="btn-add" onclick="addGoal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
            </div>
        </div>
        
        <!-- –ü–†–ò–°–£–¢–°–¢–í–ò–ï -->
        <div class="card">
            <div class="card-title">
                üë• –®–∞–≥ 4: –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ
                <span id="attendanceStats"></span>
            </div>
            
            <div class="attendance-compact" id="attendanceList"></div>
        </div>
        
        <!-- –ù–ï–ó–ê–ö–†–´–¢–´–ï –í–û–ü–†–û–°–´ -->
        <div class="card" id="openIssuesCard" style="display: none;">
            <div class="card-title">
                ‚ö†Ô∏è –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ø—Ä–æ—à–ª—ã—Ö –≤—Å—Ç—Ä–µ—á
                <span class="badge badge-warning" id="openIssuesCount">0</span>
            </div>
            <div id="openIssuesContainer"></div>
        </div>
        
        <!-- –ì–†–£–ü–ü–´ –¢–†–ê–ù–°–ü–û–†–¢–ê -->
        <div class="card">
            <div class="card-title">üöó –ì—Ä—É–ø–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</div>
            <div id="vehiclesContainer"></div>
            <button class="btn-add" onclick="addVehicle()">+ –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
        </div>
        
        <!-- –ó–ê–î–ê–ß–ò -->
        <div class="card">
            <div class="card-title">‚úÖ –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
            <div id="tasksContainer"></div>
            <button class="btn-add" onclick="addTask()">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
        
        <!-- –£–ó–ö–ò–ï –ú–ï–°–¢–ê -->
        <div class="card">
            <div class="card-title">üî¥ –£–∑–∫–∏–µ –º–µ—Å—Ç–∞</div>
            <div id="bottlenecksContainer"></div>
            <button class="btn-add" onclick="addBottleneck()">+ –î–æ–±–∞–≤–∏—Ç—å —É–∑–∫–æ–µ –º–µ—Å—Ç–æ</button>
        </div>
        
        <!-- –¢–û–ß–ö–ò –†–û–°–¢–ê -->
        <div class="card">
            <div class="card-title">üü¢ –¢–æ—á–∫–∏ —Ä–æ—Å—Ç–∞</div>
            <div id="growthPointsContainer"></div>
            <button class="btn-add" onclick="addGrowthPoint()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É —Ä–æ—Å—Ç–∞</button>
        </div>
        
        <!-- –ù–û–í–û–í–í–ï–î–ï–ù–ò–Ø -->
        <div class="card">
            <div class="card-title">üí° –ù–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è</div>
            <textarea id="innovations" placeholder="–ù–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è..."></textarea>
        </div>
        
        <!-- –í–´–í–û–î–´ -->
        <div class="card">
            <div class="card-title">üìù –í—ã–≤–æ–¥—ã –∏ —Ä–µ—à–µ–Ω–∏—è</div>
            <textarea id="conclusions" placeholder="–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏..."></textarea>
        </div>
        
        <!-- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô -->
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn btn-success" style="flex: 1; min-width: 200px;" onclick="saveProtocol()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ü–†–û–¢–û–ö–û–õ</button>
                <button class="btn btn-primary" style="flex: 1; min-width: 200px;" onclick="showHistory()">üìö –ò—Å—Ç–æ—Ä–∏—è –≤—Å—Ç—Ä–µ—á</button>
                <button class="btn btn-secondary" onclick="newMeeting()">üÜï –ù–æ–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–†–û–¢–û–ö–û–õ–ê -->
    <div class="modal" id="protocolModal">
        <button class="close-modal" onclick="closeModal()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="modal-content" id="protocolContent"></div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ò–°–¢–û–†–ò–ò -->
    <div class="modal" id="historyModal">
        <button class="close-modal" onclick="closeHistoryModal()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="modal-content">
            <div class="modal-header">üìö –ò—Å—Ç–æ—Ä–∏—è –≤—Å—Ç—Ä–µ—á</div>
            <div id="historyList"></div>
        </div>
    </div>
    
    <!-- –ü–õ–ê–í–ê–Æ–©–ò–ô –ß–ï–ö–õ–ò–°–¢ -->
    <div class="checklist-float" id="checklistFloat">
        <div class="checklist-header">
            <h3>‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏</h3>
            <button class="checklist-close" onclick="toggleChecklist()">‚úï</button>
        </div>
        <div class="checklist-body" id="checklistContainer"></div>
        <div class="checklist-footer">
            <button class="btn-add" style="width: 100%;" onclick="addChecklistItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            <div style="margin-top: 10px; text-align: center;">
                <span class="badge badge-success" id="checklistProgress">0/0</span>
            </div>
        </div>
    </div>
    
    <script>
        // =============================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // =============================
        let totalSeconds = 0;
        let speakerSeconds = 0;
        let totalInterval = null;
        let speakerInterval = null;
        let currentSpeakerId = null;
        
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let departments = JSON.parse(localStorage.getItem('departments')) || [];
        let vehicleGroups = JSON.parse(localStorage.getItem('vehicleGroups')) || [];
        let meetings = JSON.parse(localStorage.getItem('meetings')) || [];
        let openIssues = JSON.parse(localStorage.getItem('openIssues')) || [];
        let focuses = JSON.parse(localStorage.getItem('focuses')) || [];
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let checklistItems = JSON.parse(localStorage.getItem('checklistItems')) || [];
        let selectedParticipants = JSON.parse(localStorage.getItem('lastParticipants')) || [];
        
        // =============================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–•
        // =============================
        function initData() {
            if (departments.length === 0) {
                departments = [
                    { id: 1, name: '–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ' },
                    { id: 2, name: '–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä' },
                    { id: 3, name: '–¢–æ–ø–ª–∏–≤—â–∏–∫–∏' },
                    { id: 6, name: '–°–ª–µ—Å–∞—Ä–Ω—ã–π —Ü–µ—Ö' },
                    { id: 7, name: '–¢—É—Ä–±–æ-–º–∞—Å—Ç–µ—Ä–∞' },
                    { id: 8, name: '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥' },
                    { id: 9, name: '–§–∏–Ω–∞–Ω—Å—ã/–°–∫–ª–∞–¥' }
                ];
                localStorage.setItem('departments', JSON.stringify(departments));
            }
            
            if (vehicleGroups.length === 0) {
                vehicleGroups = [
                    { name: 'A1 –¢–ù–í–î (–õ–µ–≥–∫)' },
                    { name: 'A2 –¢–ù–í–î (–ì—Ä—É–∑)' },
                    { name: 'B1 –§–æ—Ä—Å—É–Ω–∫–∏' },
                    { name: 'G1 –ê–≤—Ç–æ–º–æ–±–∏–ª—å' },
                    { name: 'D1 –¢—É—Ä–±—ñ–Ω–∞ (–ª–µ–≥–∫)' },
                    { name: 'D2 –¢—É—Ä–±—ñ–Ω–∞ (–ì—Ä—É–∑)' },
                    { name: 'C1 –ù–∞—Å–æ—Å-–§–æ—Ä—Å—É–Ω–∫–∏ (–õ–µ–≥–∫)' },
                    { name: '–ü—Ä–æ–¥–∞–∂–∞' },
                    { name: 'F1 PLD (–ì—Ä—É–∑)' },
                    { name: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ï–ë–£' },
                    { name: 'C2 –ù–∞—Å–æ—Å-–§–æ—Ä—Å—É–Ω–∫–∏ (–ì—Ä—É–∑)' }
                ];
                localStorage.setItem('vehicleGroups', JSON.stringify(vehicleGroups));
            }
            
            if (checklistItems.length === 0) {
                checklistItems = [
                    { id: 1, text: '–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤', completed: false, order: 1 },
                    { id: 2, text: '–û–∑–≤—É—á–∏—Ç—å —Ñ–æ–∫—É—Å –∏ —Ü–µ–ª–∏ –≤—Å—Ç—Ä–µ—á–∏', completed: false, order: 2 },
                    { id: 3, text: '–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ø—Ä–æ—à–ª—ã—Ö –≤—Å—Ç—Ä–µ—á', completed: false, order: 3 },
                    { id: 4, text: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≥—Ä—É–ø–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞', completed: false, order: 4 },
                    { id: 5, text: '–ü–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏ —Å –¥–µ–¥–ª–∞–π–Ω–∞–º–∏', completed: false, order: 5 },
                    { id: 6, text: '–û–±—Å—É–¥–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö', completed: false, order: 6 },
                    { id: 7, text: '–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫–∏ —Ä–æ—Å—Ç–∞', completed: false, order: 7 },
                    { id: 8, text: '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥—ã', completed: false, order: 8 },
                    { id: 9, text: '–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–æ–Ω–∏–º–∞—é—Ç —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏', completed: false, order: 9 }
                ];
                localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
            }
            
            if (employees.length === 0) {
                const rawEmployees = [
                    {name: "–í–∞–ª–µ—Ä—ñ–π –Ü–≤–∞–Ω–æ–≤–∏—á", position: "–ì–µ–Ω–¥–∏—Ä–µ–∫—Ç–æ—Ä", department: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"},
                    {name: "–í—ñ–∫—Ç–æ—Ä—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", position: "–Ü–Ω—Å–ø–µ–∫—Ç–æ—Ä", department: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"},
                    {name: "–®–µ–Ω–¥—Ä–∏—á–µ–Ω–∫–æ –û–ª–µ–∫—Å—ñ–π", position: "–ù–∞—á. —Å–ª–µ—Å–∞—Ä–Ω–æ–≥–æ —Ü–µ—Ö–∞", department: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"},
                    {name: "–ì–∞–ª—è–Ω—Ç –í–ª–∞–¥–∏–º–∏—Ä", position: "–ó–∞–º.–î–∏—Ä.", department: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"},
                    {name: "–ú–æ–ª–æ–¥–∞—è –Æ–ª–∏—è", position: "–ó–∞–º.–î–∏—Ä. –†–û2", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–®—É–∫–∏–Ω –í–ª–∞–¥–∏–º–∏—Ä", position: "–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥", department: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},
                    {name: "–ò–≥–æ—Ä—å –í–∏—Ä—á–µ–Ω–∫–æ", position: "–†–û–ü", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–ö–æ–Ω—Ç–∞—Ä—î–≤ –ú–∞–∫—Å–∏–º", position: "–ú–µ–Ω–µ–¥–∂–µ—Ä-–æ–ø–µ—Ä–∞—Ç–æ—Ä", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–®–µ–ø–æ—Ç–∞—Ç—å—î–≤ –î–º–∏—Ç—Ä–æ", position: "–ú–µ–Ω–µ–¥–∂–µ—Ä-–æ–ø–µ—Ä–∞—Ç–æ—Ä", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–õ–∞–Ω—å–æ –ü–∞–≤–ª–æ", position: "–ú–µ–Ω–µ–¥–∂–µ—Ä-–æ–ø–µ—Ä–∞—Ç–æ—Ä", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–ü–∞—Å—î—á–Ω–∞ –Æ–ª—ñ—è", position: "–ê—Å–∏—Å—Ç–µ–Ω—Ç", department: "–ö–æ–ª–ª-—Ü–µ–Ω—Ç—Ä"},
                    {name: "–ë–æ—Ä—á–µ–Ω–∫–æ –ê—Ä—Ç–µ–º", position: "–¢–æ–ø–ª–∏–≤—â–∏–∫", department: "–¢–æ–ø–ª–∏–≤—â–∏–∫–∏"},
                    {name: "–©—É—Ä –í–ª–∞–¥–∏—Å–ª–∞–≤", position: "–ú–∞–π—Å—Ç–µ—Ä-–ø—Ä–∏–π–º–∞–ª—å–Ω–∏–∫", department: "–°–ª–µ—Å–∞—Ä–Ω—ã–π —Ü–µ—Ö"},
                    {name: "–ë–∞–±–∏–ª–æ–≤ –ï–≤–≥–µ–Ω–∏–π", position: "–°–ª—é—Å–∞—Ä-–¥—ñ–∞–≥–Ω–æ—Å—Ç", department: "–°–ª–µ—Å–∞—Ä–Ω—ã–π —Ü–µ—Ö"},
                    {name: "–ó–ª–∞—Ç–∏–Ω –í—è—á–µ—Å–ª–∞–≤", position: "–¢—É—Ä–±–æ-–º–∞–π—Å—Ç–µ—Ä", department: "–¢—É—Ä–±–æ-–º–∞—Å—Ç–µ—Ä–∞"},
                    {name: "–†–∞–∫—É–ª –û–ª–µ–∫—Å–µ–π", position: "–¢—É—Ä–±–æ-–º–∞–π—Å—Ç–µ—Ä", department: "–¢—É—Ä–±–æ-–º–∞—Å—Ç–µ—Ä–∞"},
                    {name: "–°—É—à–∫–æ–≤ –ê—Ä—Ç–µ–º", position: "–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç SMM", department: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},
                    {name: "–ù–µ–≤–∏–¥–Ω–∏—á–∞—è –ú–∞—Ä–∏—è", position: "–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –ú–ü", department: "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},
                    {name: "–ú–∞—Ä—á—É–∫ –ú–∞–∫—Å–∏–º", position: "–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç —Å–∫–ª–∞–¥—É", department: "–§–∏–Ω–∞–Ω—Å—ã/–°–∫–ª–∞–¥"},
                    {name: "–®–µ–π–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä", position: "–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è", department: "–§–∏–Ω–∞–Ω—Å—ã/–°–∫–ª–∞–¥"},
                    {name: "–ì–µ—Ä–µ—Ü –ï–≤–∞", position: "–ê–Ω–∞–ª–∏—Ç–∏–∫", department: "–§–∏–Ω–∞–Ω—Å—ã/–°–∫–ª–∞–¥"},
                    {name: "–î–∏–¥–∞–Ω –Æ–ª–∏—è", position: "1—Å –ê–Ω–∞–ª–∏—Ç–∏–∫", department: "–§–∏–Ω–∞–Ω—Å—ã/–°–∫–ª–∞–¥"}
                ];
                
                employees = rawEmployees.map((emp, index) => ({
                    id: index + 1,
                    name: emp.name,
                    position: emp.position,
                    department: emp.department,
                    stats: {
                        present: 0,
                        late: 0,
                        absent: 0,
                        totalSpeakingTime: 0
                    }
                }));
                localStorage.setItem('employees', JSON.stringify(employees));
            }
        }
        
        // =============================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // =============================
        window.onload = function() {
            initData();
            document.getElementById('meetingDate').valueAsDate = new Date();
            const now = new Date();
            document.getElementById('startTime').value = now.toTimeString().substring(0, 5);
            
            loadParticipantsSelector();
            loadSelectOptions();
            loadOpenIssues();
            loadFocuses();
            loadGoals();
            loadChecklist();
            
            addVehicle();
            addTask();
            addBottleneck();
            addGrowthPoint();
            
            document.querySelectorAll('input, textarea').forEach(el => {
                el.addEventListener('focus', startTotalTimer, { once: true });
            });
        };
        
        // =============================
        // –í–´–ë–û–† –£–ß–ê–°–¢–ù–ò–ö–û–í
        // =============================
        function loadParticipantsSelector() {
            const container = document.getElementById('participantsSelector');
            container.innerHTML = '';
            
            employees.forEach(emp => {
                const item = document.createElement('div');
                item.className = 'participant-checkbox-item';
                if (selectedParticipants.includes(emp.id)) {
                    item.classList.add('selected');
                }
                
                item.innerHTML = `
                    <input type="checkbox" id="part-${emp.id}" ${selectedParticipants.includes(emp.id) ? 'checked' : ''} onchange="toggleParticipant(${emp.id})">
                    <label for="part-${emp.id}" class="participant-info-mini" style="cursor: pointer;">
                        <div class="participant-name-mini">${emp.name}</div>
                        <div class="participant-role-mini">${emp.position} ¬∑ ${emp.department}</div>
                    </label>
                `;
                
                item.onclick = function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = item.querySelector('input');
                        checkbox.checked = !checkbox.checked;
                        toggleParticipant(emp.id);
                    }
                };
                
                container.appendChild(item);
            });
            
            updateSelectedCount();
            loadAttendanceList();
            loadSpeakerControls();
        }
        
        function toggleParticipant(empId) {
            const index = selectedParticipants.indexOf(empId);
            if (index === -1) {
                selectedParticipants.push(empId);
            } else {
                selectedParticipants.splice(index, 1);
            }
            
            localStorage.setItem('lastParticipants', JSON.stringify(selectedParticipants));
            
            const item = document.querySelector(`#part-${empId}`).closest('.participant-checkbox-item');
            item.classList.toggle('selected');
            
            updateSelectedCount();
            loadAttendanceList();
            loadSpeakerControls();
        }
        
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = `${selectedParticipants.length} –≤—ã–±—Ä–∞–Ω–æ`;
        }
        
        function selectAll() {
            selectedParticipants = employees.map(e => e.id);
            localStorage.setItem('lastParticipants', JSON.stringify(selectedParticipants));
            loadParticipantsSelector();
        }
        
        function deselectAll() {
            selectedParticipants = [];
            localStorage.setItem('lastParticipants', JSON.stringify(selectedParticipants));
            loadParticipantsSelector();
        }
        
        function selectLastMeeting() {
            if (meetings.length > 0) {
                const lastMeeting = meetings[meetings.length - 1];
                const lastParticipantNames = lastMeeting.attendance.map(a => a.name);
                selectedParticipants = employees.filter(e => lastParticipantNames.includes(e.name)).map(e => e.id);
                localStorage.setItem('lastParticipants', JSON.stringify(selectedParticipants));
                loadParticipantsSelector();
            } else {
                alert('–ù–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—Å—Ç—Ä–µ—á');
            }
        }
        
        function filterParticipants() {
            const search = document.getElementById('searchParticipants').value.toLowerCase();
            const items = document.querySelectorAll('.participant-checkbox-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? '' : 'none';
            });
        }
        
        function loadSelectOptions() {
            const facilitatorSelect = document.getElementById('facilitator');
            const secretarySelect = document.getElementById('secretary');
            
            facilitatorSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
            secretarySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
            
            employees.forEach(emp => {
                const option1 = document.createElement('option');
                option1.value = emp.name;
                option1.textContent = emp.name;
                facilitatorSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = emp.name;
                option2.textContent = emp.name;
                secretarySelect.appendChild(option2);
            });
        }
        
        // =============================
        // –ü–†–ò–°–£–¢–°–¢–í–ò–ï
        // =============================
        function loadAttendanceList() {
            const container = document.getElementById('attendanceList');
            container.innerHTML = '';
            
            const selected = employees.filter(e => selectedParticipants.includes(e.id));
            
            if (selected.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #666;">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–∏ –≤—ã—à–µ</p>';
                return;
            }
            
            selected.forEach(emp => {
                const item = document.createElement('div');
                item.className = 'attendance-item';
                item.id = `att-${emp.id}`;
                
                item.innerHTML = `
                    <div class="attendance-item-name">${emp.name}</div>
                    <div class="attendance-btns">
                        <button class="status-btn-mini btn-present" onclick="setStatus(${emp.id}, 'present')">‚úÖ –ï—Å—Ç—å</button>
                        <button class="status-btn-mini btn-late" onclick="setStatus(${emp.id}, 'late')">‚è∞ –û–ø–æ–∑–¥–∞–ª</button>
                        <button class="status-btn-mini btn-absent" onclick="setStatus(${emp.id}, 'absent')">‚ùå –ù–µ—Ç</button>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            updateAttendanceStats();
        }
        
        function setStatus(empId, status) {
            const item = document.getElementById(`att-${empId}`);
            item.className = 'attendance-item ' + status;
            item.setAttribute('data-status', status);
            updateAttendanceStats();
        }
        
        function updateAttendanceStats() {
            const items = document.querySelectorAll('.attendance-item');
            let present = 0, late = 0, absent = 0;
            
            items.forEach(item => {
                const status = item.getAttribute('data-status');
                if (status === 'present') present++;
                else if (status === 'late') late++;
                else if (status === 'absent') absent++;
            });
            
            document.getElementById('attendanceStats').innerHTML = `
                <span class="badge badge-success">‚úÖ ${present}</span>
                <span class="badge badge-warning">‚è∞ ${late}</span>
                <span class="badge badge-danger">‚ùå ${absent}</span>
            `;
        }
        
        // =============================
        // –ü–ê–ù–ï–õ–¨ –í–´–°–¢–£–ü–ê–Æ–©–ï–ì–û
        // =============================
        function loadSpeakerControls() {
            const container = document.getElementById('speakerControls');
            const selected = employees.filter(e => selectedParticipants.includes(e.id));
            
            container.innerHTML = '<button class="btn btn-danger" onclick="stopSpeaker()">‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>';
            
            selected.forEach(emp => {
                const totalTime = emp.stats.totalSpeakingTime || 0;
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const btn = document.createElement('button');
                btn.className = 'speaker-btn';
                btn.innerHTML = `
                    <span class="speaker-btn-name">üé§ ${emp.name}</span>
                    <span class="speaker-btn-time" id="speaker-time-${emp.id}">${timeDisplay}</span>
                `;
                btn.id = `speaker-btn-${emp.id}`;
                btn.onclick = () => startSpeaker(emp.id);
                container.appendChild(btn);
            });
        }
        
        function startSpeaker(empId) {
            if (currentSpeakerId !== null) {
                stopSpeaker();
            }
            
            currentSpeakerId = empId;
            const emp = employees.find(e => e.id === empId);
            
            document.getElementById('currentSpeaker').textContent = `–í—ã—Å—Ç—É–ø–∞–µ—Ç: ${emp.name}`;
            speakerSeconds = 0;
            
            if (speakerInterval) clearInterval(speakerInterval);
            
            speakerInterval = setInterval(() => {
                speakerSeconds++;
                const min = Math.floor(speakerSeconds / 60);
                const sec = speakerSeconds % 60;
                document.getElementById('speakerTimer').textContent = 
                    `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤ –∫–Ω–æ–ø–∫–µ –≤—ã—Å—Ç—É–ø–∞—é—â–µ–≥–æ
                const totalSeconds = (emp.stats.totalSpeakingTime || 0) + speakerSeconds;
                const totalMin = Math.floor(totalSeconds / 60);
                const totalSec = totalSeconds % 60;
                const timeDisplay = document.getElementById(`speaker-time-${empId}`);
                if (timeDisplay) {
                    timeDisplay.textContent = `${totalMin}:${totalSec.toString().padStart(2, '0')}`;
                }
            }, 1000);
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.speaker-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`speaker-btn-${empId}`).classList.add('active');
        }
        
        function stopSpeaker() {
            if (currentSpeakerId !== null) {
                const emp = employees.find(e => e.id === currentSpeakerId);
                if (emp) {
                    emp.stats.totalSpeakingTime += speakerSeconds;
                    localStorage.setItem('employees', JSON.stringify(employees));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    const totalSeconds = emp.stats.totalSpeakingTime;
                    const totalMin = Math.floor(totalSeconds / 60);
                    const totalSec = totalSeconds % 60;
                    const timeDisplay = document.getElementById(`speaker-time-${currentSpeakerId}`);
                    if (timeDisplay) {
                        timeDisplay.textContent = `${totalMin}:${totalSec.toString().padStart(2, '0')}`;
                    }
                }
            }
            
            if (speakerInterval) {
                clearInterval(speakerInterval);
                speakerInterval = null;
            }
            
            currentSpeakerId = null;
            speakerSeconds = 0;
            document.getElementById('currentSpeaker').textContent = '–ù–∏–∫—Ç–æ –Ω–µ –≤—ã—Å—Ç—É–ø–∞–µ—Ç';
            document.getElementById('speakerTimer').textContent = '00:00';
            
            document.querySelectorAll('.speaker-btn').forEach(btn => btn.classList.remove('active'));
        }
        
        // =============================
        // –¢–ê–ô–ú–ï–† –í–°–¢–†–ï–ß–ò
        // =============================
        function startTotalTimer() {
            if (!totalInterval) {
                totalInterval = setInterval(() => {
                    totalSeconds++;
                    const min = Math.floor(totalSeconds / 60);
                    const sec = totalSeconds % 60;
                    const timerElement = document.getElementById('totalTimer');
                    const messageElement = document.getElementById('timerMessage');
                    timerElement.textContent = 
                        `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
                    
                    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                    timerElement.classList.remove('warning-30', 'warning-40', 'warning-60', 'timer-warning');
                    
                    if (totalSeconds === 1800) { // 30 –º–∏–Ω—É—Ç
                        timerElement.classList.add('warning-30', 'timer-warning');
                        messageElement.style.color = '#ffc107';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = '‚ö†Ô∏è –ü—Ä–æ—à–ª–æ 30 –º–∏–Ω—É—Ç! –û—Å—Ç–∞–ª–æ—Å—å –º–∞–∫—Å–∏–º—É–º 30 –º–∏–Ω—É—Ç';
                        alert('‚è∞ –ü—Ä–æ—à–ª–æ 30 –º–∏–Ω—É—Ç! –û—Å—Ç–∞–ª–æ—Å—å –º–∞–∫—Å–∏–º—É–º 30 –º–∏–Ω—É—Ç –Ω–∞ –≤—Å—Ç—Ä–µ—á—É.');
                    } else if (totalSeconds >= 1800 && totalSeconds < 2400) {
                        timerElement.classList.add('warning-30');
                        messageElement.style.color = '#ffc107';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = '‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –¥–æ 30 –º–∏–Ω—É—Ç - –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ';
                    }
                    
                    if (totalSeconds === 2400) { // 40 –º–∏–Ω—É—Ç
                        timerElement.classList.add('warning-40', 'timer-warning');
                        messageElement.style.color = '#ff9800';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = '‚ö†Ô∏è 40 –º–∏–Ω—É—Ç! –ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 20 –º–∏–Ω—É—Ç';
                        alert('‚è∞ 40 –º–∏–Ω—É—Ç! –í—Å—Ç—Ä–µ—á–∞ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 20 –º–∏–Ω—É—Ç.');
                    } else if (totalSeconds >= 2400 && totalSeconds < 3600) {
                        timerElement.classList.add('warning-40');
                        messageElement.style.color = '#ff9800';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = '‚ö†Ô∏è –ë–æ–ª–µ–µ 40 –º–∏–Ω—É—Ç - –ø–æ—Ä–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å!';
                    }
                    
                    if (totalSeconds === 3600) { // 60 –º–∏–Ω—É—Ç
                        timerElement.classList.add('warning-60', 'timer-warning');
                        messageElement.style.color = '#dc3545';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = 'üö® 60 –ú–ò–ù–£–¢! –í—Å—Ç—Ä–µ—á–∞ —Å–∏–ª—å–Ω–æ –∑–∞—Ç—è–Ω—É–ª–∞—Å—å!';
                        alert('‚è∞ 60 –ú–ò–ù–£–¢! –í—Å—Ç—Ä–µ—á–∞ –∑–∞—Ç—è–Ω—É–ª–∞—Å—å! –°—Ä–æ—á–Ω–æ –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ!');
                    } else if (totalSeconds >= 3600) {
                        timerElement.classList.add('warning-60');
                        messageElement.style.color = '#dc3545';
                        messageElement.style.fontWeight = 'bold';
                        messageElement.textContent = 'üö® –í–°–¢–†–ï–ß–ê –°–õ–ò–®–ö–û–ú –î–û–õ–ì–û!';
                    }
                }, 1000);
            }
        }
        
        function stopTotalTimer() {
            if (totalInterval) {
                clearInterval(totalInterval);
                totalInterval = null;
            }
        }
        
        // =============================
        // –ù–ï–ó–ê–ö–†–´–¢–´–ï –í–û–ü–†–û–°–´
        // =============================
        function loadOpenIssues() {
            const card = document.getElementById('openIssuesCard');
            const container = document.getElementById('openIssuesContainer');
            const activeIssues = openIssues.filter(i => !i.closed);
            
            document.getElementById('openIssuesCount').textContent = activeIssues.length;
            
            if (activeIssues.length === 0) {
                card.style.display = 'none';
                return;
            }
            
            card.style.display = 'block';
            container.innerHTML = '';
            
            activeIssues.forEach(issue => {
                const item = document.createElement('div');
                item.style.cssText = 'background: #fff3cd; padding: 12px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #ffc107;';
                item.innerHTML = `
                    <div style="margin-bottom: 8px;">
                        <strong>${issue.description || issue.problem || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</strong><br>
                        <span style="font-size: 12px; color: #666;">–û—Ç ${new Date(issue.date).toLocaleDateString()} ¬∑ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: ${issue.responsible}</span>
                    </div>
                    <button class="btn btn-success btn-small" onclick="closeIssue(${issue.id})">‚úÖ –ó–∞–∫—Ä—ã—Ç—å</button>
                `;
                container.appendChild(item);
            });
        }
        
        function closeIssue(issueId) {
            const issue = openIssues.find(i => i.id === issueId);
            if (issue) {
                issue.closed = true;
                issue.closedDate = new Date().toISOString();
                localStorage.setItem('openIssues', JSON.stringify(openIssues));
                loadOpenIssues();
            }
        }
        
        // =============================
        // –§–û–ö–£–°–´ –ò –¶–ï–õ–ò
        // =============================
        function loadFocuses() {
            const container = document.getElementById('focusesContainer');
            container.innerHTML = '';
            
            const activeFocuses = focuses.filter(f => !f.closed);
            
            if (activeFocuses.length === 0) {
                container.innerHTML = '<p style="color: #999; font-style: italic; font-size: 13px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤</p>';
                return;
            }
            
            activeFocuses.forEach(focus => {
                const item = document.createElement('div');
                item.className = 'focus-item';
                item.innerHTML = `
                    <div class="focus-goal-text">
                        <strong>üî¥ ${focus.text}</strong>
                        <small>–î–æ–±–∞–≤–ª–µ–Ω: ${new Date(focus.addedDate).toLocaleDateString()}</small>
                    </div>
                    <div class="focus-goal-buttons">
                        <button class="btn btn-success btn-small" onclick="closeFocus(${focus.id})">‚úÖ –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function addFocus() {
            const text = prompt('–î–æ–±–∞–≤–∏—Ç—å –§–û–ö–£–° (–Ω–∞ —á—ë–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å):');
            if (text && text.trim()) {
                const focus = {
                    id: Date.now(),
                    text: text.trim(),
                    addedDate: new Date().toISOString(),
                    closed: false
                };
                focuses.push(focus);
                localStorage.setItem('focuses', JSON.stringify(focuses));
                loadFocuses();
            }
        }
        
        function closeFocus(focusId) {
            if (confirm('–ó–∞–∫—Ä—ã—Ç—å —ç—Ç–æ—Ç —Ñ–æ–∫—É—Å? (–û–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –≤—Å—Ç—Ä–µ—á)')) {
                const focus = focuses.find(f => f.id === focusId);
                if (focus) {
                    focus.closed = true;
                    focus.closedDate = new Date().toISOString();
                    localStorage.setItem('focuses', JSON.stringify(focuses));
                    loadFocuses();
                }
            }
        }
        
        function loadGoals() {
            const container = document.getElementById('goalsContainer');
            container.innerHTML = '';
            
            const activeGoals = goals.filter(g => !g.closed);
            
            if (activeGoals.length === 0) {
                container.innerHTML = '<p style="color: #999; font-style: italic; font-size: 13px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ª–µ–π</p>';
                return;
            }
            
            activeGoals.forEach(goal => {
                const item = document.createElement('div');
                item.className = 'goal-item';
                item.innerHTML = `
                    <div class="focus-goal-text">
                        <strong>üü¢ ${goal.text}</strong>
                        <small>–î–æ–±–∞–≤–ª–µ–Ω–∞: ${new Date(goal.addedDate).toLocaleDateString()}</small>
                    </div>
                    <div class="focus-goal-buttons">
                        <button class="btn btn-success btn-small" onclick="closeGoal(${goal.id})">‚úÖ –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function addGoal() {
            const text = prompt('–î–æ–±–∞–≤–∏—Ç—å –¶–ï–õ–¨ (–∫—É–¥–∞ –¥–≤–∏–∂–µ–º—Å—è –≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ):');
            if (text && text.trim()) {
                const goal = {
                    id: Date.now(),
                    text: text.trim(),
                    addedDate: new Date().toISOString(),
                    closed: false
                };
                goals.push(goal);
                localStorage.setItem('goals', JSON.stringify(goals));
                loadGoals();
            }
        }
        
        function closeGoal(goalId) {
            if (confirm('–ó–∞–∫—Ä—ã—Ç—å —ç—Ç—É —Ü–µ–ª—å? (–û–Ω–∞ –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –≤—Å—Ç—Ä–µ—á)')) {
                const goal = goals.find(g => g.id === goalId);
                if (goal) {
                    goal.closed = true;
                    goal.closedDate = new Date().toISOString();
                    localStorage.setItem('goals', JSON.stringify(goals));
                    loadGoals();
                }
            }
        }
        
        // =============================
        // –ß–ï–ö–õ–ò–°–¢ –ö–û–û–†–î–ò–ù–ê–¶–ò–ò
        // =============================
        function toggleChecklist() {
            const checklistFloat = document.getElementById('checklistFloat');
            checklistFloat.classList.toggle('show');
        }
        
        function loadChecklist() {
            const container = document.getElementById('checklistContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
            const sortedItems = checklistItems.sort((a, b) => a.order - b.order);
            const completed = sortedItems.filter(item => item.completed).length;
            
            document.getElementById('checklistProgress').textContent = `${completed}/${sortedItems.length}`;
            
            sortedItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'checklist-item' + (item.completed ? ' completed' : '');
                div.innerHTML = `
                    <input type="checkbox" ${item.completed ? 'checked' : ''} onchange="toggleChecklistItem(${item.id})">
                    <div class="checklist-item-text">${item.text}</div>
                    <button class="btn btn-danger btn-small" onclick="deleteChecklistItem(${item.id})">‚úï</button>
                `;
                container.appendChild(div);
            });
        }
        
        function toggleChecklistItem(itemId) {
            const item = checklistItems.find(i => i.id === itemId);
            if (item) {
                item.completed = !item.completed;
                localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
                loadChecklist();
            }
        }
        
        function addChecklistItem() {
            const text = prompt('–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤ —á–µ–∫–ª–∏—Å—Ç:');
            if (text && text.trim()) {
                const maxOrder = checklistItems.length > 0 ? Math.max(...checklistItems.map(i => i.order)) : 0;
                const item = {
                    id: Date.now(),
                    text: text.trim(),
                    completed: false,
                    order: maxOrder + 1
                };
                checklistItems.push(item);
                localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
                loadChecklist();
            }
        }
        
        function deleteChecklistItem(itemId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç –∏–∑ —á–µ–∫–ª–∏—Å—Ç–∞?')) {
                checklistItems = checklistItems.filter(i => i.id !== itemId);
                localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
                loadChecklist();
            }
        }
        
        function resetChecklist() {
            checklistItems.forEach(item => {
                item.completed = false;
            });
            localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
            loadChecklist();
        }
        
        // =============================
        // –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–¢–†–û–ö
        // =============================
        function addVehicle() {
            const container = document.getElementById('vehiclesContainer');
            const row = document.createElement('div');
            row.className = 'data-row vehicle-row';
            
            const options = vehicleGroups.map(v => `<option value="${v.name}">${v.name}</option>`).join('');
            
            row.innerHTML = `
                <select><option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>${options}</select>
                <input type="text" placeholder="–ü–ª–∞–Ω">
                <input type="text" placeholder="–§–∞–∫—Ç">
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(row);
        }
        
        function addMetric() {
            const container = document.getElementById('metricsContainer');
            const row = document.createElement('div');
            row.className = 'data-row metric-row';
            
            const options = departments.map(d => `<option value="${d.name}">${d.name}</option>`).join('');
            
            row.innerHTML = `
                <select><option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª...</option>${options}</select>
                <input type="text" placeholder="–ü–ª–∞–Ω">
                <input type="text" placeholder="–§–∞–∫—Ç">
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(row);
        }
        
        function addTask() {
            const container = document.getElementById('tasksContainer');
            const num = container.children.length + 1;
            const row = document.createElement('div');
            row.className = 'data-row task-row';
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–∏
            const selected = employees.filter(e => selectedParticipants.includes(e.id));
            const responsibleOptions = selected.map(emp => `<option value="${emp.name}">${emp.name}</option>`).join('');
            
            row.innerHTML = `
                <input type="text" value="${num}" readonly style="background: #e9ecef; text-align: center;">
                <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
                <select>
                    <option value="">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π...</option>
                    ${responsibleOptions}
                </select>
                <input type="date">
                <button class="btn btn-success btn-small" onclick="toggleClosed(this)">‚úÖ</button>
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove(); renumberTasks()">‚úï</button>
            `;
            container.appendChild(row);
        }
        
        function toggleClosed(btn) {
            const row = btn.closest('.data-row');
            row.classList.toggle('closed');
            btn.textContent = row.classList.contains('closed') ? '‚Ü©Ô∏è' : '‚úÖ';
        }
        
        function renumberTasks() {
            const tasks = document.querySelectorAll('#tasksContainer .task-row');
            tasks.forEach((task, index) => {
                task.querySelector('input').value = index + 1;
            });
        }
        
        function addBottleneck() {
            const container = document.getElementById('bottlenecksContainer');
            const row = document.createElement('div');
            row.className = 'data-row bottleneck-row';
            
            // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è "–ö—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç"
            const allEmployeesOptions = employees.map(emp => `<option value="${emp.name}">${emp.name}</option>`).join('');
            
            // –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–∏ –¥–ª—è "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π"
            const selected = employees.filter(e => selectedParticipants.includes(e.id));
            const responsibleOptions = selected.map(emp => `<option value="${emp.name}">${emp.name}</option>`).join('');
            
            row.innerHTML = `
                <input type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É–∑–∫–æ–≥–æ –º–µ—Å—Ç–∞">
                <select onchange="if(this.value==='custom'){this.style.display='none'; const inp=document.createElement('input'); inp.type='text'; inp.placeholder='–í–≤–µ–¥–∏—Ç–µ –∏–º—è'; inp.style.padding='8px'; inp.style.fontSize='13px'; this.parentElement.insertBefore(inp, this.nextSibling);}" style="flex: 1;">
                    <option value="">–ö—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç...</option>
                    ${allEmployeesOptions}
                    <option value="custom">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–µ –∏–∑ —Å–ø–∏—Å–∫–∞</option>
                </select>
                <input type="text" placeholder="–†–µ—à–µ–Ω–∏–µ">
                <select>
                    <option value="">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π...</option>
                    ${responsibleOptions}
                </select>
                <button class="btn btn-success btn-small" onclick="toggleClosed(this)">‚úÖ</button>
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(row);
        }
        
        function addGrowthPoint() {
            const container = document.getElementById('growthPointsContainer');
            const row = document.createElement('div');
            row.className = 'data-row growth-row';
            
            // –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–∏ –¥–ª—è "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π"
            const selected = employees.filter(e => selectedParticipants.includes(e.id));
            const responsibleOptions = selected.map(emp => `<option value="${emp.name}">${emp.name}</option>`).join('');
            
            row.innerHTML = `
                <input type="text" placeholder="–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å / —Ä–∞–∑–≤–∏—Ç—å">
                <input type="text" placeholder="–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å">
                <select>
                    <option value="">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π...</option>
                    ${responsibleOptions}
                </select>
                <button class="btn btn-success btn-small" onclick="toggleClosed(this)">‚úÖ</button>
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove()">‚úï</button>
            `;
            container.appendChild(row);
        }
        
        // =============================
        // –°–û–•–†–ê–ù–ï–ù–ò–ï –ü–†–û–¢–û–ö–û–õ–ê
        // =============================
        function saveProtocol() {
            stopTotalTimer();
            stopSpeaker();
            
            const meetingData = {
                id: Date.now(),
                date: document.getElementById('meetingDate').value,
                startTime: document.getElementById('startTime').value,
                duration: Math.floor(totalSeconds / 60),
                facilitator: document.getElementById('facilitator').value,
                secretary: document.getElementById('secretary').value,
                focuses: focuses.filter(f => !f.closed).map(f => f.text),
                goals: goals.filter(g => !g.closed).map(g => g.text),
                attendance: [],
                vehicles: [],
                tasks: [],
                bottlenecks: [],
                growthPoints: [],
                innovations: document.getElementById('innovations').value,
                conclusions: document.getElementById('conclusions').value
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ
            document.querySelectorAll('.attendance-item').forEach(item => {
                const empId = parseInt(item.id.replace('att-', ''));
                const emp = employees.find(e => e.id === empId);
                const status = item.getAttribute('data-status') || 'absent';
                
                if (emp) {
                    meetingData.attendance.push({
                        name: emp.name,
                        position: emp.position,
                        department: emp.department,
                        status: status
                    });
                    
                    emp.stats[status]++;
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –≥—Ä—É–ø–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
            document.querySelectorAll('#vehiclesContainer .vehicle-row').forEach(row => {
                const inputs = row.querySelectorAll('select, input');
                if (inputs[0].value) {
                    meetingData.vehicles.push({
                        group: inputs[0].value,
                        plan: inputs[1].value,
                        fact: inputs[2].value
                    });
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –∑–∞–¥–∞—á–∏
            document.querySelectorAll('#tasksContainer .task-row').forEach(row => {
                const inputs = row.querySelectorAll('input, select');
                const isClosed = row.classList.contains('closed');
                if (inputs[1].value) {
                    const task = {
                        id: Date.now() + Math.random(),
                        number: inputs[0].value,
                        description: inputs[1].value,
                        responsible: inputs[2].value,
                        deadline: inputs[3].value,
                        closed: isClosed,
                        date: meetingData.date
                    };
                    meetingData.tasks.push(task);
                    
                    if (!isClosed) {
                        openIssues.push(task);
                    }
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
            document.querySelectorAll('#bottlenecksContainer .bottleneck-row').forEach(row => {
                const elements = row.querySelectorAll('input, select');
                const isClosed = row.classList.contains('closed');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π –∏–Ω–ø—É—Ç
                let blocker = '';
                if (elements[1].tagName === 'SELECT') {
                    blocker = elements[1].value;
                } else {
                    // –≠—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π input
                    blocker = elements[1].value;
                }
                
                if (elements[0].value) {
                    const bottleneck = {
                        id: Date.now() + Math.random(),
                        description: elements[0].value,
                        blocker: blocker,
                        solution: elements[2].value,
                        responsible: elements[3].value,
                        closed: isClosed,
                        date: meetingData.date
                    };
                    meetingData.bottlenecks.push(bottleneck);
                    
                    if (!isClosed) {
                        openIssues.push(bottleneck);
                    }
                }
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º —Ç–æ—á–∫–∏ —Ä–æ—Å—Ç–∞
            document.querySelectorAll('#growthPointsContainer .growth-row').forEach(row => {
                const elements = row.querySelectorAll('input, select');
                const isClosed = row.classList.contains('closed');
                if (elements[0].value) {
                    const growthPoint = {
                        id: Date.now() + Math.random(),
                        description: elements[0].value,
                        howTo: elements[1].value,
                        responsible: elements[2].value,
                        closed: isClosed,
                        date: meetingData.date
                    };
                    meetingData.growthPoints.push(growthPoint);
                    
                    if (!isClosed) {
                        openIssues.push(growthPoint);
                    }
                }
            });
            
            meetings.push(meetingData);
            localStorage.setItem('meetings', JSON.stringify(meetings));
            localStorage.setItem('employees', JSON.stringify(employees));
            localStorage.setItem('openIssues', JSON.stringify(openIssues));
            localStorage.setItem('focuses', JSON.stringify(focuses));
            localStorage.setItem('goals', JSON.stringify(goals));
            
            generateProtocolHTML(meetingData);
            
            alert('‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
        }
        
        function generateProtocolHTML(data) {
            let html = `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px;">
                    <h1 style="color: #667eea;">–ü–†–û–¢–û–ö–û–õ –ö–û–û–†–î–ò–ù–ê–¶–ò–û–ù–ù–û–ô –í–°–¢–†–ï–ß–ò ‚Ññ${meetings.length}</h1>
                    <p><strong>–î–∞—Ç–∞:</strong> ${new Date(data.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })} | <strong>–í—Ä–µ–º—è:</strong> ${data.startTime} | <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${data.duration} –º–∏–Ω</p>
                    <p><strong>–í–µ–¥—É—â–∏–π:</strong> ${data.facilitator} | <strong>–ü—Ä–æ—Ç–æ–∫–æ–ª–∏—Å—Ç:</strong> ${data.secretary}</p>
                </div>
            `;
            
            if ((data.focuses && data.focuses.length > 0) || (data.goals && data.goals.length > 0)) {
                html += `<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">`;
                
                if (data.focuses && data.focuses.length > 0) {
                    html += `
                        <h3 style="color: #dc3545; margin-bottom: 10px; font-size: 16px;">üî¥ –§–û–ö–£–°–´ (—Ç–µ–∫—É—â–∏–µ)</h3>
                        <ul style="margin: 0 0 15px 20px; padding: 0;">
                    `;
                    data.focuses.forEach(focus => {
                        html += `<li style="margin-bottom: 5px;"><strong>${focus}</strong></li>`;
                    });
                    html += '</ul>';
                }
                
                if (data.goals && data.goals.length > 0) {
                    html += `
                        <h3 style="color: #28a745; margin-bottom: 10px; font-size: 16px;">üü¢ –¶–ï–õ–ò (–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞)</h3>
                        <ul style="margin: 0 0 0 20px; padding: 0;">
                    `;
                    data.goals.forEach(goal => {
                        html += `<li style="margin-bottom: 5px;"><strong>${goal}</strong></li>`;
                    });
                    html += '</ul>';
                }
                
                html += '</div>';
            }
            
            const present = data.attendance.filter(a => a.status === 'present').length;
            const late = data.attendance.filter(a => a.status === 'late').length;
            const absent = data.attendance.filter(a => a.status === 'absent').length;
            
            html += `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #667eea; margin-bottom: 12px;">üë• –ü–†–ò–°–£–¢–°–¢–í–ò–ï (${present + late}/${data.attendance.length})</h3>
                    <p><strong>–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏:</strong> ${data.attendance.filter(a => a.status === 'present').map(a => a.name).join(', ') || '-'}</p>
                    <p><strong>–û–ø–æ–∑–¥–∞–ª–∏:</strong> ${data.attendance.filter(a => a.status === 'late').map(a => a.name).join(', ') || '-'}</p>
                    <p><strong>–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏:</strong> ${data.attendance.filter(a => a.status === 'absent').map(a => a.name).join(', ') || '-'}</p>
                </div>
            `;
            
            if (data.vehicles.length > 0) {
                html += `
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #667eea; margin-bottom: 12px;">üöó –ì–†–£–ü–ü–´ –¢–†–ê–ù–°–ü–û–†–¢–ê</h3>
                        <table>
                            <tr><th>–ì—Ä—É–ø–ø–∞</th><th>–ü–ª–∞–Ω</th><th>–§–∞–∫—Ç</th></tr>
                `;
                data.vehicles.forEach(v => {
                    html += `<tr><td>${v.group}</td><td>${v.plan}</td><td><strong>${v.fact}</strong></td></tr>`;
                });
                html += '</table></div>';
            }
            
            if (data.tasks.length > 0) {
                html += `
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #667eea; margin-bottom: 12px;">‚úÖ –ó–ê–î–ê–ß–ò (${data.tasks.length})</h3>
                        <table>
                            <tr><th>‚Ññ</th><th>–ó–∞–¥–∞—á–∞</th><th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th><th>–î–µ–¥–ª–∞–π–Ω</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
                `;
                data.tasks.forEach(t => {
                    html += `<tr><td>${t.number}</td><td>${t.description}</td><td><strong>${t.responsible}</strong></td><td>${t.deadline ? new Date(t.deadline).toLocaleDateString('ru-RU') : '-'}</td><td>${t.closed ? '‚úÖ –ó–∞–∫—Ä—ã—Ç–∞' : '‚è≥ –í —Ä–∞–±–æ—Ç–µ'}</td></tr>`;
                });
                html += '</table></div>';
            }
            
            if (data.bottlenecks && data.bottlenecks.length > 0) {
                html += `
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #dc3545; margin-bottom: 12px;">üî¥ –£–ó–ö–ò–ï –ú–ï–°–¢–ê</h3>
                        <table>
                            <tr><th>–£–∑–∫–æ–µ –º–µ—Å—Ç–æ</th><th>–ö—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç</th><th>–†–µ—à–µ–Ω–∏–µ</th><th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
                `;
                data.bottlenecks.forEach(b => {
                    html += `<tr><td>${b.description}</td><td>${b.blocker}</td><td>${b.solution}</td><td><strong>${b.responsible}</strong></td><td>${b.closed ? '‚úÖ –†–µ—à–µ–Ω–æ' : '‚è≥ –í —Ä–∞–±–æ—Ç–µ'}</td></tr>`;
                });
                html += '</table></div>';
            }
            
            if (data.growthPoints && data.growthPoints.length > 0) {
                html += `
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #28a745; margin-bottom: 12px;">üü¢ –¢–û–ß–ö–ò –†–û–°–¢–ê</h3>
                        <table>
                            <tr><th>–ß—Ç–æ —Ä–∞–∑–≤–∏–≤–∞–µ–º</th><th>–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å</th><th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
                `;
                data.growthPoints.forEach(g => {
                    html += `<tr><td>${g.description}</td><td>${g.howTo}</td><td><strong>${g.responsible}</strong></td><td>${g.closed ? '‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ' : '‚è≥ –í —Ä–∞–±–æ—Ç–µ'}</td></tr>`;
                });
                html += '</table></div>';
            }
            
            if (data.innovations) {
                html += `<div style="margin-bottom: 25px;"><h3 style="color: #667eea; margin-bottom: 12px;">üí° –ù–û–í–û–í–í–ï–î–ï–ù–ò–Ø</h3><p>${data.innovations.replace(/\n/g, '<br>')}</p></div>`;
            }
            
            if (data.conclusions) {
                html += `<div style="margin-bottom: 25px;"><h3 style="color: #667eea; margin-bottom: 12px;">üìù –í–´–í–û–î–´</h3><p>${data.conclusions.replace(/\n/g, '<br>')}</p></div>`;
            }
            
            html += `
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" onclick="window.print()" style="margin: 8px;">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                    <button class="btn btn-primary" onclick="closeModal()" style="margin: 8px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            document.getElementById('protocolContent').innerHTML = html;
            document.getElementById('protocolModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('protocolModal').style.display = 'none';
        }
        
        // =============================
        // –ò–°–¢–û–†–ò–Ø
        // =============================
        function showHistory() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';
            
            if (meetings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">–ò—Å—Ç–æ—Ä–∏—è –≤—Å—Ç—Ä–µ—á –ø—É—Å—Ç–∞</p>';
            } else {
                meetings.slice().reverse().forEach((meeting, index) => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    const present = meeting.attendance.filter(a => a.status === 'present' || a.status === 'late').length;
                    const focusCount = (meeting.focuses || []).length;
                    const goalCount = (meeting.goals || []).length;
                    item.innerHTML = `
                        <h4>–í—Å—Ç—Ä–µ—á–∞ ‚Ññ${meetings.length - index} –æ—Ç ${new Date(meeting.date).toLocaleDateString('ru-RU')}</h4>
                        <p>‚è±Ô∏è ${meeting.duration} –º–∏–Ω | üë• ${present}/${meeting.attendance.length} | üî¥ ${focusCount} —Ñ–æ–∫—É—Å–æ–≤ | üü¢ ${goalCount} —Ü–µ–ª–µ–π | üìã ${meeting.tasks.length} –∑–∞–¥–∞—á</p>
                    `;
                    item.onclick = () => generateProtocolHTML(meeting);
                    container.appendChild(item);
                });
            }
            
            document.getElementById('historyModal').style.display = 'block';
        }
        
        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }
        
        // =============================
        // –ù–û–í–ê–Ø –í–°–¢–†–ï–ß–ê
        // =============================
        function newMeeting() {
            if (confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –≤—Å—Ç—Ä–µ—á—É? –í—Å–µ –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã.')) {
                // –û—á–∏—Å—Ç–∫–∞
                document.getElementById('vehiclesContainer').innerHTML = '';
                document.getElementById('tasksContainer').innerHTML = '';
                document.getElementById('bottlenecksContainer').innerHTML = '';
                document.getElementById('growthPointsContainer').innerHTML = '';
                document.getElementById('innovations').value = '';
                document.getElementById('conclusions').value = '';
                
                // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–æ–≤
                totalSeconds = 0;
                speakerSeconds = 0;
                stopTotalTimer();
                stopSpeaker();
                document.getElementById('totalTimer').textContent = '00:00';
                document.getElementById('speakerTimer').textContent = '00:00';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
                document.getElementById('meetingDate').valueAsDate = new Date();
                const now = new Date();
                document.getElementById('startTime').value = now.toTimeString().substring(0, 5);
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
                loadAttendanceList();
                loadOpenIssues();
                loadFocuses();
                loadGoals();
                resetChecklist();
                
                addVehicle();
                addTask();
                addBottleneck();
                addGrowthPoint();
                
                window.scrollTo(0, 0);
                alert('‚úÖ –ù–æ–≤–∞—è –≤—Å—Ç—Ä–µ—á–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
            }
        }
    </script>
</body>
</html>